<main class="shell">
  <!-- OH22 Logo - Top Right Corner -->
  <div class="oh22-logo">
    <img src="assets/logos/oh22_Logo_weiss_CMYK.png" alt="OH22 Logo">
  </div>

  <!-- User Info Box (visible after puzzle start, only if user data exists) -->
  <div class="user-info-box" *ngIf="showUserInfo && !puzzleComplete && userData">
    <div class="info-card">
      <h3>{{ getUserDisplayName() }}</h3>
      <div class="user-stats">
        <p><strong>{{ 'userInfo.language' | translate }}</strong> {{ getLanguageText() }}</p>
        <p><strong>{{ 'userInfo.bestTime' | translate }}</strong> {{ formatTime(userData.fastestTimeSeconds) }}</p>
        <p><strong>{{ 'userInfo.maxPieces' | translate }}</strong> {{ userData.maxPiecesAchieved ?? '-' }}</p>
        <p><strong>{{ 'userInfo.completed' | translate }}</strong> {{ userData.totalPuzzlesCompleted ?? 0 }}</p>
      </div>
    </div>
  </div>

  <header class="hero">
    <h1 *ngIf="showGreetingHeader; else standardTitle">
      <span class="greeting-name">{{ greetingNamePart }}</span><br>
      <span class="greeting-message">{{ greetingMessagePart }}</span>
    </h1>
    <ng-template #standardTitle>
      <h1>{{ ('app.title.' + salutationVariant) | translate }}</h1>
    </ng-template>
    <h1 *ngIf="showInstructions" class="instruction-heading">
      <span class="greeting-message">{{ ('instructions.drag.' + salutationVariant) | translate }}</span>
    </h1>
  </header>

  <section class="board">
    <div class="game-wrapper">
      <div #gameHost class="game-host" aria-label="Puzzle board"></div>

      <button
        type="button"
        class="menu-toggle"
        (click)="toggleMenu()"
        aria-label="Toggle puzzle menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav *ngIf="menuOpen" class="mobile-menu" aria-label="Puzzle options">
        <button type="button" (click)="toggleDebug()">
          {{ showDebug ? ('menu.hideGuides' | translate) : ('menu.showGuides' | translate) }}
        </button>
        <button type="button" (click)="toggleGlassMode()">
          {{ useGlassStyle ? ('menu.opaquePieces' | translate) : ('menu.glassPieces' | translate) }}
        </button>
        <!-- Language switcher in mobile menu -->
        <div class="mobile-language-switcher">
          <app-language-switcher></app-language-switcher>
        </div>
        <button type="button" (click)="closeMenu()">{{ 'menu.close' | translate }}</button>
      </nav>

      <div class="intro-overlay" *ngIf="showIntroOverlay">
        <div class="intro-card">
          <h1>{{ ('app.title.' + salutationVariant) | translate }}</h1>
          <p>{{ ('hero.description.' + salutationVariant) | translate }}</p>
          <button type="button" (click)="startPuzzle()">{{ 'buttons.startPuzzle' | translate }}</button>
        </div>
      </div>

      <!-- Completion Modal -->
      <app-modal [isVisible]="puzzleComplete" [wide]="true">
        <h1 [innerHTML]="('completion.perfect.' + salutationVariant) | translate: { time: formatTime(completionTime) }"></h1>
        <p [innerHTML]="('completion.perfectDescription.' + salutationVariant) | translate"></p>
        <div class="modal-actions">
          <button type="button" *ngIf="!hideRestartButton" (click)="restartPuzzle()">{{ 'buttons.newGame' | translate }}</button>
          <button type="button" (click)="donateCoins()">{{ 'buttons.submitTime' | translate }}</button>
        </div>
      </app-modal>

      <!-- Stag Modal -->
      <app-modal [isVisible]="showInitialContinueButton && !puzzleComplete" [wide]="true">
        <h1>{{ 'modals.stagTitle' | translate }}</h1>
        <p>{{ ('modals.stagProblem.' + salutationVariant) | translate }}</p>
        <button type="button" (click)="continueToPuzzle()">{{ 'buttons.continue' | translate }}</button>
      </app-modal>

      <!-- Explosion Modal -->
      <app-modal [isVisible]="showExplosionModal && !puzzleComplete" [wide]="true">
        <h1>{{ 'modals.explosionTitle' | translate }}</h1>
        <p>{{ ('modals.explosionDescription.' + salutationVariant) | translate }}</p>
        <button type="button" (click)="closeExplosionModal()">{{ 'buttons.letsGo' | translate }}</button>
      </app-modal>

      <!-- Thank You Modal -->
      <app-modal [isVisible]="showThankYouModal" [wide]="true">
        <h1>{{ ('completion.thankYouTitle.' + salutationVariant) | translate }}</h1>
        <p [innerHTML]="('completion.thankYouBody.' + salutationVariant) | translate"></p>
        <p *ngIf="thankYouErrorMessage" class="thank-you-error">{{ thankYouErrorMessage }}</p>
        <div class="modal-actions">
          <button type="button" (click)="startNextRound()">{{ 'buttons.nextRound' | translate }}</button>
          <button type="button" (click)="closeThankYouModal()">{{ 'buttons.close' | translate }}</button>
        </div>
      </app-modal>
      
    </div>
    
    <div class="desktop-controls-wrapper">
      
      <div class="desktop-controls">
        <button type="button" (click)="toggleDebug()">
          {{ showDebug ? ('menu.hideGuides' | translate) : ('menu.showGuides' | translate) }}
        </button>
        <button type="button" (click)="toggleGlassMode()">
          {{ useGlassStyle ? ('menu.opaquePieces' | translate) : ('menu.glassPieces' | translate) }}
        </button>
      </div>
      <div class="desktop-language-switcher">
        <app-language-switcher></app-language-switcher>
      </div>
    </div>
    
  </section>
</main>
