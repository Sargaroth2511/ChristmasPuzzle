<main class="shell">
  <!-- Language Switcher -->
  <app-language-switcher></app-language-switcher>
  
  <!-- User Info Box (visible during initial scene, only if user data exists) -->
  <div class="user-info-box" *ngIf="showUserInfo && !puzzleComplete && userData">
    <div class="info-card">
      <h3>{{ getUserDisplayName() }}</h3>
      <div class="user-stats">
        <p><strong>{{ 'userInfo.language' | translate }}</strong> {{ getLanguageText() }}</p>
        <p><strong>{{ 'userInfo.bestTime' | translate }}</strong> {{ formatTime(userData.fastestTimeSeconds) }}</p>
        <p><strong>{{ 'userInfo.maxPieces' | translate }}</strong> {{ userData.maxPiecesAchieved ?? '-' }}</p>
        <p><strong>{{ 'userInfo.completed' | translate }}</strong> {{ userData.totalPuzzlesCompleted ?? 0 }}</p>
      </div>
    </div>
  </div>

  <header class="hero">
    <h1>{{ 'app.title' | translate }}</h1>
    <p>{{ 'hero.description' | translate }}</p>
  </header>

  <section class="board">
    <div class="game-wrapper">
      <div #gameHost class="game-host" aria-label="Puzzle board"></div>

      <button
        type="button"
        class="menu-toggle"
        (click)="toggleMenu()"
        aria-label="Toggle puzzle menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav *ngIf="menuOpen" class="mobile-menu" aria-label="Puzzle options">
        <button type="button" (click)="toggleDebug()">
          {{ showDebug ? ('menu.hideGuides' | translate) : ('menu.showGuides' | translate) }}
        </button>
        <button type="button" (click)="toggleGlassMode()">
          {{ useGlassStyle ? ('menu.opaquePieces' | translate) : ('menu.glassPieces' | translate) }}
        </button>
        <button type="button" (click)="closeMenu()">{{ 'menu.close' | translate }}</button>
      </nav>

      <div class="intro-overlay" *ngIf="showIntroOverlay">
        <div class="intro-card">
          <h1>{{ 'app.title' | translate }}</h1>
          <p>{{ 'hero.description' | translate }}</p>
          <button type="button" (click)="startPuzzle()">{{ 'buttons.startPuzzle' | translate }}</button>
        </div>
      </div>

      <div class="complete-overlay" *ngIf="puzzleComplete">
        <div class="complete-card">
          <div *ngIf="coinTotal === 22">
            <h2 [innerHTML]="'completion.perfect' | translate: { time: formatTime(completionTime) }"></h2>
            <p [innerHTML]="'completion.perfectDescription' | translate"></p>
            <p>{{ 'completion.perfectTryAgain' | translate }}</p>
            <div class="complete-actions">
              <button type="button" *ngIf="!hideRestartButton" (click)="restartPuzzle()">{{ 'buttons.newGame' | translate }}</button>
              <button type="button" (click)="donateCoins()">{{ 'buttons.sendCoins' | translate }}</button>
            </div>
          </div>
          <div *ngIf="coinTotal > 0 && coinTotal < 22">
            <h2>{{ 'completion.partial' | translate: { coins: (coinTotal | number: '1.0-0'), time: formatTime(completionTime) } }}</h2>
            <p [innerHTML]="'completion.partialDescription' | translate"></p>
            <p>{{ 'completion.partialTryAgain' | translate }}</p>
            <div class="complete-actions">
              <button type="button" *ngIf="!hideRestartButton" (click)="restartPuzzle()">{{ 'buttons.newGame' | translate }}</button>
              <button type="button" (click)="donateCoins()">{{ 'buttons.sendCoins' | translate }}</button>
            </div>
          </div>
          <div *ngIf="coinTotal === 0">
            <h2>{{ 'completion.noCoins' | translate }}</h2>
            <p>{{ 'completion.noCoinsFirstPart' | translate: { time: formatTime(completionTime) } }}</p>
            <p [innerHTML]="'completion.noCoinsSecondPart' | translate"></p>
            <p>{{ 'completion.noCoinsReady' | translate }}</p>
            <div class="complete-actions">
              <button type="button" *ngIf="!hideRestartButton" (click)="restartPuzzle()">{{ 'buttons.newGame' | translate }}</button>
            </div>
          </div>
          <div class="complete-donation" *ngIf="donationMessageVisible">
            <span>{{ 'completion.donationMessage' | translate: { coins: (coinTotal | number: '1.0-0') } }}</span>
          </div>
        </div>
      </div>

      <div class="stag-modal" *ngIf="showInitialContinueButton && !puzzleComplete">
        <div class="modal-content">
          <p class="greeting-text">{{ greetingMessage }}</p>
          <h1>{{ 'modals.stagProblem' | translate }}</h1>
          <button type="button" (click)="continueToPuzzle()">{{ 'buttons.continue' | translate }}</button>
        </div>
      </div>

      <div class="explosion-modal" *ngIf="showExplosionModal && !puzzleComplete">
        <div class="modal-content">
          <h1>{{ 'modals.explosionTitle' | translate }}</h1>
          <p>{{ 'modals.explosionDescription' | translate }}</p>
          <button type="button" (click)="closeExplosionModal()">{{ 'buttons.letsGo' | translate }}</button>
        </div>
      </div>
    </div>

        <p class="instruction-text" [class.visible]="showInstructions">{{ 'instructions.drag' | translate }}</p>

    <div class="desktop-controls">
      <button type="button" (click)="toggleDebug()">
        {{ showDebug ? ('menu.hideGuides' | translate) : ('menu.showGuides' | translate) }}
      </button>
      <button type="button" (click)="toggleGlassMode()">
        {{ useGlassStyle ? ('menu.opaquePieces' | translate) : ('menu.glassPieces' | translate) }}
      </button>
    </div>
  </section>
</main>
